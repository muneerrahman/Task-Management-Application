{% extends "tasks/base.html" %}
{% block content %}
<h2>All Users</h2>
<a href="{% url 'superadmin_create_user' %}">Create User</a>

<table border="1">
<tr>
    <th>Username</th>
    <th>Role</th>
    <th>Staff</th>
    <th>Admin Assigned</th>
    <th>Actions</th>
</tr>
{% for user in users %}
<tr>
    <!-- Edit user form -->
    <form method="POST" action="{% url 'superadmin_edit_user' user.id %}">
        {% csrf_token %}
        <td><input type="text" name="username" value="{{ user.username }}" required></td>
        <td>
            <select name="role">
                <option value="superadmin" {% if user.role == 'superadmin' %}selected{% endif %}>Superadmin</option>
                <option value="admin" {% if user.role == 'admin' %}selected{% endif %}>Admin</option>
                <option value="user" {% if user.role == 'user' %}selected{% endif %}>User</option>
            </select>
        </td>
        <td>
            <input type="checkbox" name="is_staff" {% if user.is_staff %}checked{% endif %}>
        </td>
        <td>
            <!-- Assign Admin dropdown -->
            <select name="assigned_admin" onchange="this.form.submit()">
                <option value="">None</option>
                {% for admin in admins %}
                    <option value="{{ admin.id }}" {% if user.admin and user.admin.id == admin.id %}selected{% endif %}>
                        {{ admin.username }}
                    </option>
                {% endfor %}
            </select>
        </td>
        <td>
            <!-- Delete user -->
            <form method="POST" action="{% url 'superadmin_delete_user' user.id %}" style="display:inline;">
                {% csrf_token %}
                <button type="submit" style="color:red;" onclick="return confirm('Are you sure you want to delete this user?')">Delete</button>
            </form>
        </td>
    </form>
</tr>
{% endfor %}
</table>
{% endblock %}
